import{a as Ee,b as X}from"./chunk-IBBFEWMW.js";import{$a as ve,Ba as H,Ha as k,Ia as f,Ja as v,Ka as U,L as le,Na as ee,Oa as $,Pa as M,Sa as G,Ta as V,U as R,Ua as q,V as D,Va as Q,W as de,Wa as _,Xa as K,Ya as pe,Za as fe,_a as he,lb as be,ma as me,mb as we,na as x,qb as ye,rb as xe,sa as ue,sb as Pe,tb as Ce,ua as N,ub as _e,ya as ge}from"./chunk-ACLKYFFW.js";import{e as c}from"./chunk-JHI3MBHO.js";var Re=X("FaceDetection",{web:()=>import("./chunk-DXXNB3JW.js").then(r=>new r.FaceDetectionWeb)}),Y=Re;function ke(r){return{no_face:"Position your face in the frame",move_closer:"Move closer",move_back:"Move back a little",move_left:"Move slightly left",move_right:"Move slightly right",move_up:"Move up a little",move_down:"Move down a little",hold_still:"Perfect! Hold still",multiple_faces:"Only one face allowed"}[r]}var F=(function(r){return r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE",r})(F||{}),O=class extends Error{constructor(e,i,t){super(e),this.message=e,this.code=i,this.data=t}},De=r=>{var e,i;return r?.androidBridge?"android":!((i=(e=r?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||i===void 0)&&i.bridge?"ios":"web"},Fe=r=>{let e=r.CapacitorCustomPlatform||null,i=r.Capacitor||{},t=i.Plugins=i.Plugins||{},n=()=>e!==null?e.name:De(r),a=()=>n()!=="web",o=d=>{let m=u.get(d);return!!(m?.platforms.has(n())||s(d))},s=d=>{var m;return(m=i.PluginHeaders)===null||m===void 0?void 0:m.find(p=>p.name===d)},l=d=>r.console.error(d),u=new Map,g=(d,m={})=>{let p=u.get(d);if(p)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),p.proxy;let w=n(),E=s(d),b,Se=()=>c(null,null,function*(){return!b&&w in m?b=typeof m[w]=="function"?b=yield m[w]():b=m[w]:e!==null&&!b&&"web"in m&&(b=typeof m.web=="function"?b=yield m.web():b=m.web),b}),Ae=(h,y)=>{var C,I;if(E){let L=E?.methods.find(P=>y===P.name);if(L)return L.rtype==="promise"?P=>i.nativePromise(d,y.toString(),P):(P,j)=>i.nativeCallback(d,y.toString(),P,j);if(h)return(C=h[y])===null||C===void 0?void 0:C.bind(h)}else{if(h)return(I=h[y])===null||I===void 0?void 0:I.bind(h);throw new O(`"${d}" plugin is not implemented on ${w}`,F.Unimplemented)}},Z=h=>{let y,C=(...I)=>{let L=Se().then(P=>{let j=Ae(P,h);if(j){let W=j(...I);return y=W?.remove,W}else throw new O(`"${d}.${h}()" is not implemented on ${w}`,F.Unimplemented)});return h==="addListener"&&(L.remove=()=>c(null,null,function*(){return y()})),L};return C.toString=()=>`${h.toString()}() { [capacitor code] }`,Object.defineProperty(C,"name",{value:h,writable:!1,configurable:!1}),C},se=Z("addListener"),ce=Z("removeListener"),Ue=(h,y)=>{let C=se({eventName:h},y),I=()=>c(null,null,function*(){let P=yield C;ce({eventName:h,callbackId:P},y)}),L=new Promise(P=>C.then(()=>P({remove:I})));return L.remove=()=>c(null,null,function*(){console.warn("Using addListener() without 'await' is deprecated."),yield I()}),L},J=new Proxy({},{get(h,y){switch(y){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return E?Ue:se;case"removeListener":return ce;default:return Z(y)}}});return t[d]=J,u.set(d,{name:d,proxy:J,platforms:new Set([...Object.keys(m),...E?[w]:[]])}),J};return i.convertFileSrc||(i.convertFileSrc=d=>d),i.getPlatform=n,i.handleError=l,i.isNativePlatform=a,i.isPluginAvailable=o,i.registerPlugin=g,i.Exception=O,i.DEBUG=!!i.DEBUG,i.isLoggingEnabled=!!i.isLoggingEnabled,i},Te=r=>r.Capacitor=Fe(r),te=Te(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),T=te.registerPlugin,A=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,i){let t=!1;this.listeners[e]||(this.listeners[e]=[],t=!0),this.listeners[e].push(i);let a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),t&&this.sendRetainedArgumentsForEvent(e);let o=()=>c(this,null,function*(){return this.removeListener(e,i)});return Promise.resolve({remove:o})}removeAllListeners(){return c(this,null,function*(){this.listeners={};for(let e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}})}notifyListeners(e,i,t){let n=this.listeners[e];if(!n){if(t){let a=this.retainedEventArguments[e];a||(a=[]),a.push(i),this.retainedEventArguments[e]=a}return}n.forEach(a=>a(i))}hasListeners(e){var i;return!!(!((i=this.listeners[e])===null||i===void 0)&&i.length)}registerWindowListener(e,i){this.windowListeners[i]={registered:!1,windowEventName:e,pluginEventName:i,handler:t=>{this.notifyListeners(i,t)}}}unimplemented(e="not implemented"){return new te.Exception(e,F.Unimplemented)}unavailable(e="not available"){return new te.Exception(e,F.Unavailable)}removeListener(e,i){return c(this,null,function*(){let t=this.listeners[e];if(!t)return;let n=t.indexOf(i);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])})}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let i=this.retainedEventArguments[e];i&&(delete this.retainedEventArguments[e],i.forEach(t=>{this.notifyListeners(e,t)}))}};var Me=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Oe=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),ne=class extends A{getCookies(){return c(this,null,function*(){let e=document.cookie,i={};return e.split(";").forEach(t=>{if(t.length<=0)return;let[n,a]=t.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=Oe(n).trim(),a=Oe(a).trim(),i[n]=a}),i})}setCookie(e){return c(this,null,function*(){try{let i=Me(e.key),t=Me(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${i}=${t||""}${n}; path=${a}; ${o};`}catch(i){return Promise.reject(i)}})}deleteCookie(e){return c(this,null,function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(i){return Promise.reject(i)}})}clearCookies(){return c(this,null,function*(){try{let e=document.cookie.split(";")||[];for(let i of e)document.cookie=i.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})}clearAllCookies(){return c(this,null,function*(){try{yield this.clearCookies()}catch(e){return Promise.reject(e)}})}},tt=T("CapacitorCookies",{web:()=>new ne}),ze=r=>c(null,null,function*(){return new Promise((e,i)=>{let t=new FileReader;t.onload=()=>{let n=t.result;e(n.indexOf(",")>=0?n.split(",")[1]:n)},t.onerror=n=>i(n),t.readAsDataURL(r)})}),Be=(r={})=>{let e=Object.keys(r);return Object.keys(r).map(n=>n.toLocaleLowerCase()).reduce((n,a,o)=>(n[a]=r[e[o]],n),{})},je=(r,e=!0)=>r?Object.entries(r).reduce((t,n)=>{let[a,o]=n,s,l;return Array.isArray(o)?(l="",o.forEach(u=>{s=e?encodeURIComponent(u):u,l+=`${a}=${s}&`}),l.slice(0,-1)):(s=e?encodeURIComponent(o):o,l=`${a}=${s}`),`${t}&${l}`},"").substr(1):null,We=(r,e={})=>{let i=Object.assign({method:r.method||"GET",headers:r.headers},e),n=Be(r.headers)["content-type"]||"";if(typeof r.data=="string")i.body=r.data;else if(n.includes("application/x-www-form-urlencoded")){let a=new URLSearchParams;for(let[o,s]of Object.entries(r.data||{}))a.set(o,s);i.body=a.toString()}else if(n.includes("multipart/form-data")||r.data instanceof FormData){let a=new FormData;if(r.data instanceof FormData)r.data.forEach((s,l)=>{a.append(l,s)});else for(let s of Object.keys(r.data))a.append(s,r.data[s]);i.body=a;let o=new Headers(i.headers);o.delete("content-type"),i.headers=o}else(n.includes("application/json")||typeof r.data=="object")&&(i.body=JSON.stringify(r.data));return i},ie=class extends A{request(e){return c(this,null,function*(){let i=We(e,e.webFetchExtra),t=je(e.params,e.shouldEncodeUrlParams),n=t?`${e.url}?${t}`:e.url,a=yield fetch(n,i),o=a.headers.get("content-type")||"",{responseType:s="text"}=a.ok?e:{};o.includes("application/json")&&(s="json");let l,u;switch(s){case"arraybuffer":case"blob":u=yield a.blob(),l=yield ze(u);break;case"json":l=yield a.json();break;case"document":case"text":default:l=yield a.text()}let g={};return a.headers.forEach((d,m)=>{g[m]=d}),{data:l,headers:g,status:a.status,url:a.url}})}get(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))})}post(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))})}put(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))})}patch(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})}delete(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})}},nt=T("CapacitorHttp",{web:()=>new ie});var ae=class extends A{setStyle(){return c(this,null,function*(){this.unavailable("not available for web")})}setAnimation(){return c(this,null,function*(){this.unavailable("not available for web")})}show(){return c(this,null,function*(){this.unavailable("not available for web")})}hide(){return c(this,null,function*(){this.unavailable("not available for web")})}},it=T("SystemBars",{web:()=>new ae});var S=(function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r})(S||{}),z=(function(r){return r.Rear="REAR",r.Front="FRONT",r})(z||{}),re=(function(r){return r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl",r})(re||{});var B=class extends A{getPhoto(e){return c(this,null,function*(){return new Promise((i,t)=>c(this,null,function*(){if(e.webUseInput||e.source===S.Photos)this.fileInputExperience(e,i,t);else if(e.source===S.Prompt){let n=document.querySelector("pwa-action-sheet");n||(n=document.createElement("pwa-action-sheet"),document.body.appendChild(n)),n.header=e.promptLabelHeader||"Photo",n.cancelable=!1,n.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],n.addEventListener("onSelection",a=>c(this,null,function*(){a.detail===0?this.fileInputExperience(e,i,t):this.cameraExperience(e,i,t)}))}else this.cameraExperience(e,i,t)}))})}pickImages(e){return c(this,null,function*(){return new Promise((i,t)=>c(this,null,function*(){this.multipleFileInputExperience(i,t)}))})}cameraExperience(e,i,t){return c(this,null,function*(){if(customElements.get("pwa-camera-modal")){let n=document.createElement("pwa-camera-modal");n.facingMode=e.direction===z.Front?"user":"environment",document.body.appendChild(n);try{yield n.componentOnReady(),n.addEventListener("onPhoto",a=>c(this,null,function*(){let o=a.detail;o===null?t(new O("User cancelled photos app")):o instanceof Error?t(o):i(yield this._getCameraPhoto(o,e)),n.dismiss(),document.body.removeChild(n)})),n.present()}catch{this.fileInputExperience(e,i,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,i,t)})}fileInputExperience(e,i,t){let n=document.querySelector("#_capacitor-camera-input"),a=()=>{var o;(o=n.parentNode)===null||o===void 0||o.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",o=>{let s=n.files[0],l="jpeg";if(s.type==="image/png"?l="png":s.type==="image/gif"&&(l="gif"),e.resultType==="dataUrl"||e.resultType==="base64"){let u=new FileReader;u.addEventListener("load",()=>{if(e.resultType==="dataUrl")i({dataUrl:u.result,format:l});else if(e.resultType==="base64"){let g=u.result.split(",")[1];i({base64String:g,format:l})}a()}),u.readAsDataURL(s)}else i({webPath:URL.createObjectURL(s),format:l}),a()}),n.addEventListener("cancel",o=>{t(new O("User cancelled photos app")),a()})),n.accept="image/*",n.capture=!0,e.source===S.Photos||e.source===S.Prompt?n.removeAttribute("capture"):e.direction===z.Front?n.capture="user":e.direction===z.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(e,i){let t=document.querySelector("#_capacitor-camera-input-multiple"),n=()=>{var a;(a=t.parentNode)===null||a===void 0||a.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",a=>{let o=[];for(let s=0;s<t.files.length;s++){let l=t.files[s],u="jpeg";l.type==="image/png"?u="png":l.type==="image/gif"&&(u="gif"),o.push({webPath:URL.createObjectURL(l),format:u})}e({photos:o}),n()}),t.addEventListener("cancel",a=>{i(new O("User cancelled photos app")),n()})),t.accept="image/*",t.click()}_getCameraPhoto(e,i){return new Promise((t,n)=>{let a=new FileReader,o=e.type.split("/")[1];i.resultType==="uri"?t({webPath:URL.createObjectURL(e),format:o,saved:!1}):(a.readAsDataURL(e),a.onloadend=()=>{let s=a.result;i.resultType==="dataUrl"?t({dataUrl:s,format:o,saved:!1}):t({base64String:s.split(",")[1],format:o,saved:!1})},a.onerror=s=>{n(s)})})}checkPermissions(){return c(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return c(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return c(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return c(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},lt=new B;var Ie=T("Camera",{web:()=>new B});var He=X("BackgroundRemoval",{web:()=>import("./chunk-W3527X35.js").then(r=>new r.BackgroundRemovalWeb)}),oe=He;var Le=(()=>{let e=class e{constructor(){this.bgRemovalAvailable=null,this.checkBackgroundRemovalAvailability()}checkBackgroundRemovalAvailability(){return c(this,null,function*(){try{let t=yield oe.isAvailable();this.bgRemovalAvailable=t.available,console.log(`Background removal available: ${t.available} (${t.platform})`)}catch{this.bgRemovalAvailable=!1,console.log("Background removal not available")}})}takePicture(){return c(this,null,function*(){return(yield Ie.getPhoto({quality:100,allowEditing:!1,resultType:re.DataUrl,source:S.Camera})).dataUrl||""})}cropImage(t,n,a,o,s){return c(this,null,function*(){return new Promise((l,u)=>{let g=new Image;g.onload=()=>{let d=document.createElement("canvas"),m=d.getContext("2d");if(!m){u(new Error("Could not get canvas context"));return}d.width=o,d.height=s,m.drawImage(g,n,a,o,s,0,0,o,s),l(d.toDataURL("image/png"))},g.onerror=u,g.src=t})})}resizeImage(t,n=256,a=256){return c(this,null,function*(){return new Promise((o,s)=>{let l=new Image;l.onload=()=>{let u=document.createElement("canvas"),g=u.getContext("2d");if(!g){s(new Error("Could not get canvas context"));return}u.width=n,u.height=a,g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.drawImage(l,0,0,n,a),o(u.toDataURL("image/png"))},l.onerror=s,l.src=t})})}compressImage(t,n=10){return c(this,null,function*(){let a=yield this.loadImage(t),o=document.createElement("canvas"),s=o.getContext("2d");if(!s)throw new Error("Could not get canvas context");o.width=a.width,o.height=a.height,s.drawImage(a,0,0);let l=.1,u=.95,g=.7,d=null,m="",p=n*1024,w=1024;for(let E=0;E<8;E++){let b=yield this.canvasToBlob(o,g);if(Math.abs(b.size-p)<w){d=b;break}(!d||Math.abs(b.size-p)<Math.abs(d.size-p))&&(d=b),b.size>p?(u=g,g=(l+g)/2):(l=g,g=(u+g)/2)}if(!d)throw new Error("Failed to compress image");return m=yield this.blobToDataUrl(d),{dataUrl:m,blob:d,size:d.size}})}loadImage(t){return new Promise((n,a)=>{let o=new Image;o.onload=()=>n(o),o.onerror=a,o.src=t})}canvasToBlob(t,n){return new Promise((a,o)=>{t.toBlob(s=>{s?a(s):o(new Error("Failed to create blob"))},"image/jpeg",n)})}blobToDataUrl(t){return new Promise((n,a)=>{let o=new FileReader;o.onloadend=()=>n(o.result),o.onerror=a,o.readAsDataURL(t)})}removeBackground(t,n=!0){return c(this,null,function*(){try{let a=yield oe.removeBackground({imageData:t,useEllipticalMask:n});return{dataUrl:a.dataUrl,faceDetected:a.faceDetected}}catch(a){throw console.error("Background removal failed:",a),a}})}isBackgroundRemovalAvailable(){return c(this,null,function*(){return this.bgRemovalAvailable!==null?this.bgRemovalAvailable:(yield this.checkBackgroundRemovalAvailability(),this.bgRemovalAvailable??!1)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=le({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var Ve=["videoElement"],qe=["canvasElement"],Qe=["detectionCanvas"];function Ke(r,e){r&1&&(f(0,"div",20),de(),f(1,"svg",21),U(2,"ellipse",22),v()())}function Xe(r,e){if(r&1){let i=ee();f(0,"div",5)(1,"div",6)(2,"div",7),U(3,"video",8,0)(5,"div",9),H(6,Ke,3,0,"div",10),v(),f(7,"div",11),_(8),v(),f(9,"div",12)(10,"label",13)(11,"span",14),_(12,"Sensitivity"),v()(),f(13,"input",15),ve("ngModelChange",function(n){R(i);let a=M();return he(a.sensitivity,n)||(a.sensitivity=n),D(n)}),v(),f(14,"span",16),_(15),v()(),U(16,"canvas",17,1)(18,"canvas",17,2),v(),f(20,"div",18)(21,"button",19),$("click",function(){R(i);let n=M();return D(n.captureAndProcess())}),v()()()}if(r&2){let i=M();x(3),Q("mirror",i.useFrontCamera),k("hidden",!i.isWebCameraActive),x(3),k("ngIf",!i.isWebCameraActive),x(),Q("success",i.faceGuidance==="hold_still")("warning",i.faceGuidance!=="hold_still"&&i.faceGuidance!=="no_face"&&i.faceGuidance!=="multiple_faces")("error",i.faceGuidance==="no_face"||i.faceGuidance==="multiple_faces"),x(),pe(" ",i.guidanceMessage," "),x(5),fe("ngModel",i.sensitivity),x(2),K(i.sensitivity<.33?"Strict":i.sensitivity<.66?"Normal":"Lenient"),x(6),Q("disabled",i.faceGuidance!=="hold_still"),k("disabled",i.faceGuidance!=="hold_still")}}function Ye(r,e){if(r&1&&(f(0,"div",25),U(1,"div",26),f(2,"p",27),_(3),v()()),r&2){let i=M(2);x(3),K(i.processingStep)}}function Ze(r,e){if(r&1){let i=ee();f(0,"div",25),U(1,"img",28),f(2,"div",29)(3,"span"),_(4),v(),f(5,"span",30),_(6,"\xB7"),v(),f(7,"span"),_(8,"256\xD7256"),v()(),f(9,"div",31)(10,"button",32),$("click",function(){R(i);let n=M(2);return D(n.retake())}),_(11,"Retake"),v(),f(12,"button",33),$("click",function(){R(i);let n=M(2);return D(n.confirmImage())}),_(13,"Confirm"),v()()()}if(r&2){let i=M(2);x(),k("src",i.processedImage.dataUrl,me),x(3),K(i.formatFileSize(i.processedImage.size))}}function Je(r,e){if(r&1&&(f(0,"div",23),H(1,Ye,4,1,"div",24)(2,Ze,14,2,"div",24),v()),r&2){let i=M();x(),k("ngIf",i.isProcessing),x(),k("ngIf",i.processedImage&&!i.isProcessing)}}var Mt=(()=>{let e=class e{constructor(t,n){this.imageProcessingService=t,this.ngZone=n,this.processedImage=null,this.isProcessing=!1,this.processingStep="",this.isCameraActive=!1,this.isWebCameraActive=!1,this.useFrontCamera=!0,this.mediaStream=null,this.faceGuidance="no_face",this.guidanceMessage="Initializing...",this.faceDetectionReady=!1,this.isDetecting=!1,this.detectionInterval=null,this.sensitivity=.5,this.ovalBounds={centerX:.5,centerY:.5,radiusX:.32,radiusY:.42},this.initializeFaceDetection()}ngOnInit(){this.startCamera()}ngOnDestroy(){this.stopWebCamera(),this.stopFaceDetection(),Y.dispose().catch(()=>{})}initializeFaceDetection(){return c(this,null,function*(){try{console.log("Initializing face detection...");let t=yield Y.initialize();this.faceDetectionReady=t.success,console.log("Face detection ready:",t.success),t.success?this.guidanceMessage="Position your face in the frame":this.guidanceMessage="Face detection unavailable"}catch(t){console.error("Face detection init error:",t),this.faceDetectionReady=!1,this.guidanceMessage="Face detection unavailable"}})}startCamera(){return c(this,null,function*(){this.isCameraActive=!0,this.processedImage=null,this.faceGuidance="no_face",this.guidanceMessage=this.faceDetectionReady?"Position your face in the frame":"Initializing...",Ee.isNativePlatform()||setTimeout(()=>this.startWebCamera(),100)})}startWebCamera(){return c(this,null,function*(){try{let t={video:{facingMode:this.useFrontCamera?"user":"environment",width:{ideal:1280},height:{ideal:720}},audio:!1};this.mediaStream=yield navigator.mediaDevices.getUserMedia(t),this.isWebCameraActive=!0;let n=(a=5)=>{if(this.videoElement?.nativeElement&&this.mediaStream){let o=this.videoElement.nativeElement;o.srcObject=this.mediaStream,o.onloadedmetadata=()=>{o.play().then(()=>{console.log("Camera stream started"),this.startFaceDetection()}).catch(s=>console.error("Error playing video:",s))}}else a>0&&setTimeout(()=>n(a-1),100)};setTimeout(()=>n(),100)}catch(t){console.error("Error accessing camera:",t),this.isWebCameraActive=!1,this.isCameraActive=!1}})}startFaceDetection(){if(this.detectionInterval)return;let t=(n=20)=>{this.faceDetectionReady?(console.log("Starting face detection loop"),this.detectionInterval=setInterval(()=>{this.isWebCameraActive&&!this.isDetecting&&this.detectFaceInFrame()},250)):n>0?setTimeout(()=>t(n-1),500):(console.log("Face detection not available, skipping"),this.guidanceMessage="Position your face in the frame")};t()}stopFaceDetection(){this.detectionInterval&&(clearInterval(this.detectionInterval),this.detectionInterval=null),this.isDetecting=!1}detectFaceInFrame(){return c(this,null,function*(){if(!this.videoElement?.nativeElement||!this.detectionCanvas?.nativeElement)return;let t=this.videoElement.nativeElement;if(!(t.videoWidth===0||t.videoHeight===0)){this.isDetecting=!0;try{let n=this.detectionCanvas.nativeElement,a=n.getContext("2d");if(!a)return;let o=t.videoWidth,s=t.videoHeight,l=Math.min(o,s),u=(o-l)/2,g=(s-l)/2,d=Math.floor(l*.4);n.width=d,n.height=d,this.useFrontCamera&&(a.translate(n.width,0),a.scale(-1,1)),a.drawImage(t,u,g,l,l,0,0,d,d);let m=n.toDataURL("image/jpeg",.5),p=yield Y.detectFace({imageData:m,ovalBounds:this.ovalBounds,sensitivity:this.sensitivity});this.ngZone.run(()=>{this.faceGuidance=p.guidance,this.guidanceMessage=ke(p.guidance)})}catch(n){console.error("Face detection error:",n)}finally{this.isDetecting=!1}}})}stopWebCamera(){this.stopFaceDetection(),this.mediaStream&&(this.mediaStream.getTracks().forEach(t=>t.stop()),this.mediaStream=null),this.isWebCameraActive=!1}captureAndProcess(){return c(this,null,function*(){try{let t,n,a;if(this.isWebCameraActive&&this.videoElement?.nativeElement&&this.canvasElement?.nativeElement){let m=this.videoElement.nativeElement,p=this.canvasElement.nativeElement;p.width=m.videoWidth,p.height=m.videoHeight,n=m.videoWidth,a=m.videoHeight;let w=p.getContext("2d");if(!w)return;this.useFrontCamera&&(w.translate(p.width,0),w.scale(-1,1)),w.drawImage(m,0,0),t=p.toDataURL("image/jpeg",.95),this.stopWebCamera()}else{t=yield this.imageProcessingService.takePicture();let m=new Image;yield new Promise(p=>{m.onload=()=>{n=m.naturalWidth,a=m.naturalHeight,p()},m.src=t})}this.isCameraActive=!1,this.isProcessing=!0;let o=Math.min(n,a),s=Math.floor(o*.85),l=Math.floor((n-s)/2),u=Math.floor((a-s)/2);this.processingStep="Cropping...";let g=yield this.imageProcessingService.cropImage(t,l,u,s,s);this.processingStep="Resizing...",g=yield this.imageProcessingService.resizeImage(g,256,256),this.processingStep="Compressing to ~10KB...";let d=yield this.imageProcessingService.compressImage(g,10);this.processedImage=d,this.processingStep=""}catch(t){console.error("Error:",t),this.processingStep="Error: "+(t instanceof Error?t.message:"Unknown error"),this.isCameraActive=!1}finally{this.isProcessing=!1}})}retake(){this.processedImage=null,this.startCamera()}confirmImage(){if(this.processedImage)try{let t=this.processedImage.dataUrl.includes(",")?this.processedImage.dataUrl.split(",")[1]:this.processedImage.dataUrl;window.parent.postMessage({src:"andredewet.github.io/photo-processor",type:"image_taken",data:{base64:t}},"*")}catch(t){console.error("Error confirming image:",t)}}formatFileSize(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB"}};e.\u0275fac=function(n){return new(n||e)(N(Le),N(ue))},e.\u0275cmp=ge({type:e,selectors:[["app-home"]],viewQuery:function(n,a){if(n&1&&(G(Ve,5),G(qe,5),G(Qe,5)),n&2){let o;V(o=q())&&(a.videoElement=o.first),V(o=q())&&(a.canvasElement=o.first),V(o=q())&&(a.detectionCanvas=o.first)}},decls:2,vars:2,consts:[["videoElement",""],["canvasElement",""],["detectionCanvas",""],["class","camera-container",4,"ngIf"],["class","app-container",4,"ngIf"],[1,"camera-container"],[1,"camera-preview-area"],[1,"video-frame"],["autoplay","","playsinline","","muted","",1,"camera-video",3,"hidden"],[1,"oval-overlay"],["class","face-silhouette",4,"ngIf"],[1,"guidance-badge"],[1,"sensitivity-control"],[1,"sensitivity-label"],[1,"label-text"],["type","range","min","0","max","1","step","0.1",1,"sensitivity-slider",3,"ngModelChange","ngModel"],[1,"label-value"],[2,"display","none"],[1,"camera-controls"],[1,"btn-capture",3,"click","disabled"],[1,"face-silhouette"],["viewBox","0 0 100 120","xmlns","http://www.w3.org/2000/svg"],["cx","50","cy","45","rx","30","ry","35"],[1,"app-container"],["class","content-card",4,"ngIf"],[1,"content-card"],[1,"spinner"],[1,"processing-text"],["alt","Result",1,"result-image",3,"src"],[1,"result-info"],[1,"dot"],[1,"result-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click"]],template:function(n,a){n&1&&H(0,Xe,22,16,"div",3)(1,Je,3,2,"div",4),n&2&&(k("ngIf",a.isCameraActive),x(),k("ngIf",!a.isCameraActive))},dependencies:[we,be,_e,ye,Ce,xe,Pe],styles:["[_nghost-%COMP%]{display:block;background:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;font-size:14px;min-height:100vh;width:100%}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{background:#fff!important;margin:0;padding:0}.app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:16px;box-sizing:border-box;background:#fff;width:100%}.content-card[_ngcontent-%COMP%]{text-align:center;width:100%;max-width:320px}.content-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0 0 12px;color:#202124}.pipeline-steps[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:14px 16px;background:#f8f9fa;border-radius:8px;margin-bottom:16px;font-size:12px;font-weight:500;color:#5f6368}.pipeline-steps[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:#9aa0a6}.btn-primary[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:12px 20px;background:#1a73e8;color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background .2s}.btn-primary[_ngcontent-%COMP%]:hover{background:#1557b0}.btn-primary[_ngcontent-%COMP%]:active{transform:scale(.98)}.btn-primary[_ngcontent-%COMP%]   .btn-icon-inline[_ngcontent-%COMP%]{font-size:16px}.btn-secondary[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:10px 20px;background:#fff;color:#202124;border:1px solid #dadce0;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background .2s,border-color .2s}.btn-secondary[_ngcontent-%COMP%]:hover{background:#f8f9fa;border-color:#bdc1c6}.btn-secondary[_ngcontent-%COMP%]:active{transform:scale(.98)}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;margin:0 auto 12px;border:3px solid #f8f9fa;border-top-color:#1a73e8;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.processing-text[_ngcontent-%COMP%]{color:#5f6368;font-size:13px;margin:0}.result-image[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:8px;border:1px solid #dadce0;margin-bottom:12px;object-fit:cover;background:#f8f9fa}.result-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px;font-size:12px;color:#5f6368;margin-bottom:16px}.result-info[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{color:#dadce0}.result-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.result-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:120px}.camera-container[_ngcontent-%COMP%]{position:fixed;inset:0;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000}.camera-preview-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px;min-height:0;background:#fff}.video-frame[_ngcontent-%COMP%]{position:relative;width:min(280px,80vw,50vh);height:min(280px,80vw,50vh);background:#e8eaed;border-radius:12px;overflow:hidden;flex-shrink:0;border:1px solid #dadce0}.camera-video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.camera-video.mirror[_ngcontent-%COMP%]{transform:scaleX(-1)}.camera-video[hidden][_ngcontent-%COMP%]{display:none!important}.oval-overlay[_ngcontent-%COMP%]{position:absolute;inset:8% 18%;border:3px solid #1a73e8;border-radius:50%;pointer-events:none;box-shadow:0 0 0 2000px #ffffff80}.face-silhouette[_ngcontent-%COMP%]{position:absolute;inset:20% 25% 15%;opacity:.2;pointer-events:none}.face-silhouette[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%;fill:#9aa0a6}.camera-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:32px;padding:16px 0;flex-shrink:0;background:#fff}.btn-capture[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background:#1a73e8;border:3px solid #fff;cursor:pointer;box-shadow:0 2px 8px #1a73e866;transition:transform .1s,background .2s,opacity .2s}.btn-capture[_ngcontent-%COMP%]:hover:not(.disabled){background:#1557b0;transform:scale(1.05)}.btn-capture[_ngcontent-%COMP%]:active:not(.disabled){transform:scale(.95)}.btn-capture.disabled[_ngcontent-%COMP%]{background:#dadce0;cursor:not-allowed;opacity:.5;box-shadow:none}.guidance-badge[_ngcontent-%COMP%]{margin-top:12px;padding:8px 20px;border-radius:16px;font-size:13px;font-weight:500;text-align:center;white-space:nowrap;transition:all .3s ease;background:#f1f3f4;color:#5f6368;border:1px solid #dadce0}.guidance-badge.success[_ngcontent-%COMP%]{background:#e6f4ea;color:#137333;border-color:#34a853}.guidance-badge.warning[_ngcontent-%COMP%]{background:#fef7e0;color:#b45309;border-color:#f9ab00}.guidance-badge.error[_ngcontent-%COMP%]{background:#fce8e6;color:#c5221f;border-color:#ea4335}.sensitivity-control[_ngcontent-%COMP%]{margin-top:12px;width:min(280px,80vw);padding:0 8px}.sensitivity-label[_ngcontent-%COMP%]{display:block;text-align:center;margin-bottom:6px;font-size:12px}.sensitivity-label[_ngcontent-%COMP%]   .label-text[_ngcontent-%COMP%]{color:#5f6368}.label-value[_ngcontent-%COMP%]{display:block;text-align:center;color:#1a73e8;font-weight:500;font-size:12px;margin-top:8px;padding:4px 0}.sensitivity-slider[_ngcontent-%COMP%]{width:100%;height:4px;-webkit-appearance:none;appearance:none;background:#e8eaed;border-radius:2px;outline:none}.sensitivity-slider[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;border-radius:50%;background:#1a73e8;cursor:pointer;border:2px solid #fff;box-shadow:0 1px 4px #0003;transition:transform .1s}.sensitivity-slider[_ngcontent-%COMP%]::-webkit-slider-thumb:hover{transform:scale(1.1)}.sensitivity-slider[_ngcontent-%COMP%]::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:#1a73e8;cursor:pointer;border:2px solid #fff;box-shadow:0 1px 4px #0003}ion-header[_ngcontent-%COMP%]{display:none!important}"]});let r=e;return r})();export{Mt as HomePage};
