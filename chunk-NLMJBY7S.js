import{a as ve,b as K}from"./chunk-IBBFEWMW.js";import{Ba as W,Ha as E,Ia as v,Ja as y,Ka as U,L as le,Na as N,Oa as $,Pa as I,Sa as G,Ta as q,U as z,Ua as V,V as H,Va as Q,W as de,Wa as L,Xa as ee,Ya as fe,ib as pe,jb as he,ma as me,na as x,sa as ue,ua as J,ya as ge}from"./chunk-3BKPQURR.js";import{e as c}from"./chunk-JHI3MBHO.js";var ke=K("FaceDetection",{web:()=>import("./chunk-W6ETFFZN.js").then(r=>new r.FaceDetectionWeb)}),X=ke;function be(r){return{no_face:"Position your face in the frame",move_closer:"Move closer",move_back:"Move back a little",move_left:"Move slightly left",move_right:"Move slightly right",move_up:"Move up a little",move_down:"Move down a little",hold_still:"Perfect! Hold still",multiple_faces:"Only one face allowed"}[r]}var R=(function(r){return r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE",r})(R||{}),k=class extends Error{constructor(e,i,t){super(e),this.message=e,this.code=i,this.data=t}},Me=r=>{var e,i;return r?.androidBridge?"android":!((i=(e=r?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||i===void 0)&&i.bridge?"ios":"web"},Oe=r=>{let e=r.CapacitorCustomPlatform||null,i=r.Capacitor||{},t=i.Plugins=i.Plugins||{},n=()=>e!==null?e.name:Me(r),a=()=>n()!=="web",o=d=>{let m=u.get(d);return!!(m?.platforms.has(n())||s(d))},s=d=>{var m;return(m=i.PluginHeaders)===null||m===void 0?void 0:m.find(f=>f.name===d)},l=d=>r.console.error(d),u=new Map,g=(d,m={})=>{let f=u.get(d);if(f)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),f.proxy;let b=n(),_=s(d),h,Ce=()=>c(null,null,function*(){return!h&&b in m?h=typeof m[b]=="function"?h=yield m[b]():h=m[b]:e!==null&&!h&&"web"in m&&(h=typeof m.web=="function"?h=yield m.web():h=m.web),h}),_e=(p,w)=>{var C,M;if(_){let O=_?.methods.find(P=>w===P.name);if(O)return O.rtype==="promise"?P=>i.nativePromise(d,w.toString(),P):(P,j)=>i.nativeCallback(d,w.toString(),P,j);if(p)return(C=p[w])===null||C===void 0?void 0:C.bind(p)}else{if(p)return(M=p[w])===null||M===void 0?void 0:M.bind(p);throw new k(`"${d}" plugin is not implemented on ${b}`,R.Unimplemented)}},Y=p=>{let w,C=(...M)=>{let O=Ce().then(P=>{let j=_e(P,p);if(j){let B=j(...M);return w=B?.remove,B}else throw new k(`"${d}.${p}()" is not implemented on ${b}`,R.Unimplemented)});return p==="addListener"&&(O.remove=()=>c(null,null,function*(){return w()})),O};return C.toString=()=>`${p.toString()}() { [capacitor code] }`,Object.defineProperty(C,"name",{value:p,writable:!1,configurable:!1}),C},se=Y("addListener"),ce=Y("removeListener"),Ee=(p,w)=>{let C=se({eventName:p},w),M=()=>c(null,null,function*(){let P=yield C;ce({eventName:p,callbackId:P},w)}),O=new Promise(P=>C.then(()=>P({remove:M})));return O.remove=()=>c(null,null,function*(){console.warn("Using addListener() without 'await' is deprecated."),yield M()}),O},Z=new Proxy({},{get(p,w){switch(w){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return _?Ee:se;case"removeListener":return ce;default:return Y(w)}}});return t[d]=Z,u.set(d,{name:d,proxy:Z,platforms:new Set([...Object.keys(m),..._?[b]:[]])}),Z};return i.convertFileSrc||(i.convertFileSrc=d=>d),i.getPlatform=n,i.handleError=l,i.isNativePlatform=a,i.isPluginAvailable=o,i.registerPlugin=g,i.Exception=k,i.DEBUG=!!i.DEBUG,i.isLoggingEnabled=!!i.isLoggingEnabled,i},Ie=r=>r.Capacitor=Oe(r),te=Ie(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),D=te.registerPlugin,A=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,i){let t=!1;this.listeners[e]||(this.listeners[e]=[],t=!0),this.listeners[e].push(i);let a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),t&&this.sendRetainedArgumentsForEvent(e);let o=()=>c(this,null,function*(){return this.removeListener(e,i)});return Promise.resolve({remove:o})}removeAllListeners(){return c(this,null,function*(){this.listeners={};for(let e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}})}notifyListeners(e,i,t){let n=this.listeners[e];if(!n){if(t){let a=this.retainedEventArguments[e];a||(a=[]),a.push(i),this.retainedEventArguments[e]=a}return}n.forEach(a=>a(i))}hasListeners(e){var i;return!!(!((i=this.listeners[e])===null||i===void 0)&&i.length)}registerWindowListener(e,i){this.windowListeners[i]={registered:!1,windowEventName:e,pluginEventName:i,handler:t=>{this.notifyListeners(i,t)}}}unimplemented(e="not implemented"){return new te.Exception(e,R.Unimplemented)}unavailable(e="not available"){return new te.Exception(e,R.Unavailable)}removeListener(e,i){return c(this,null,function*(){let t=this.listeners[e];if(!t)return;let n=t.indexOf(i);this.listeners[e].splice(n,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])})}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let i=this.retainedEventArguments[e];i&&(delete this.retainedEventArguments[e],i.forEach(t=>{this.notifyListeners(e,t)}))}};var we=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),ye=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),ne=class extends A{getCookies(){return c(this,null,function*(){let e=document.cookie,i={};return e.split(";").forEach(t=>{if(t.length<=0)return;let[n,a]=t.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=ye(n).trim(),a=ye(a).trim(),i[n]=a}),i})}setCookie(e){return c(this,null,function*(){try{let i=we(e.key),t=we(e.value),n=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${i}=${t||""}${n}; path=${a}; ${o};`}catch(i){return Promise.reject(i)}})}deleteCookie(e){return c(this,null,function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(i){return Promise.reject(i)}})}clearCookies(){return c(this,null,function*(){try{let e=document.cookie.split(";")||[];for(let i of e)document.cookie=i.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})}clearAllCookies(){return c(this,null,function*(){try{yield this.clearCookies()}catch(e){return Promise.reject(e)}})}},Qe=D("CapacitorCookies",{web:()=>new ne}),Le=r=>c(null,null,function*(){return new Promise((e,i)=>{let t=new FileReader;t.onload=()=>{let n=t.result;e(n.indexOf(",")>=0?n.split(",")[1]:n)},t.onerror=n=>i(n),t.readAsDataURL(r)})}),Se=(r={})=>{let e=Object.keys(r);return Object.keys(r).map(n=>n.toLocaleLowerCase()).reduce((n,a,o)=>(n[a]=r[e[o]],n),{})},Ae=(r,e=!0)=>r?Object.entries(r).reduce((t,n)=>{let[a,o]=n,s,l;return Array.isArray(o)?(l="",o.forEach(u=>{s=e?encodeURIComponent(u):u,l+=`${a}=${s}&`}),l.slice(0,-1)):(s=e?encodeURIComponent(o):o,l=`${a}=${s}`),`${t}&${l}`},"").substr(1):null,Ue=(r,e={})=>{let i=Object.assign({method:r.method||"GET",headers:r.headers},e),n=Se(r.headers)["content-type"]||"";if(typeof r.data=="string")i.body=r.data;else if(n.includes("application/x-www-form-urlencoded")){let a=new URLSearchParams;for(let[o,s]of Object.entries(r.data||{}))a.set(o,s);i.body=a.toString()}else if(n.includes("multipart/form-data")||r.data instanceof FormData){let a=new FormData;if(r.data instanceof FormData)r.data.forEach((s,l)=>{a.append(l,s)});else for(let s of Object.keys(r.data))a.append(s,r.data[s]);i.body=a;let o=new Headers(i.headers);o.delete("content-type"),i.headers=o}else(n.includes("application/json")||typeof r.data=="object")&&(i.body=JSON.stringify(r.data));return i},ie=class extends A{request(e){return c(this,null,function*(){let i=Ue(e,e.webFetchExtra),t=Ae(e.params,e.shouldEncodeUrlParams),n=t?`${e.url}?${t}`:e.url,a=yield fetch(n,i),o=a.headers.get("content-type")||"",{responseType:s="text"}=a.ok?e:{};o.includes("application/json")&&(s="json");let l,u;switch(s){case"arraybuffer":case"blob":u=yield a.blob(),l=yield Le(u);break;case"json":l=yield a.json();break;case"document":case"text":default:l=yield a.text()}let g={};return a.headers.forEach((d,m)=>{g[m]=d}),{data:l,headers:g,status:a.status,url:a.url}})}get(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))})}post(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))})}put(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))})}patch(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})}delete(e){return c(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})}},Ke=D("CapacitorHttp",{web:()=>new ie});var ae=class extends A{setStyle(){return c(this,null,function*(){this.unavailable("not available for web")})}setAnimation(){return c(this,null,function*(){this.unavailable("not available for web")})}show(){return c(this,null,function*(){this.unavailable("not available for web")})}hide(){return c(this,null,function*(){this.unavailable("not available for web")})}},Xe=D("SystemBars",{web:()=>new ae});var S=(function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r})(S||{}),F=(function(r){return r.Rear="REAR",r.Front="FRONT",r})(F||{}),re=(function(r){return r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl",r})(re||{});var T=class extends A{getPhoto(e){return c(this,null,function*(){return new Promise((i,t)=>c(this,null,function*(){if(e.webUseInput||e.source===S.Photos)this.fileInputExperience(e,i,t);else if(e.source===S.Prompt){let n=document.querySelector("pwa-action-sheet");n||(n=document.createElement("pwa-action-sheet"),document.body.appendChild(n)),n.header=e.promptLabelHeader||"Photo",n.cancelable=!1,n.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],n.addEventListener("onSelection",a=>c(this,null,function*(){a.detail===0?this.fileInputExperience(e,i,t):this.cameraExperience(e,i,t)}))}else this.cameraExperience(e,i,t)}))})}pickImages(e){return c(this,null,function*(){return new Promise((i,t)=>c(this,null,function*(){this.multipleFileInputExperience(i,t)}))})}cameraExperience(e,i,t){return c(this,null,function*(){if(customElements.get("pwa-camera-modal")){let n=document.createElement("pwa-camera-modal");n.facingMode=e.direction===F.Front?"user":"environment",document.body.appendChild(n);try{yield n.componentOnReady(),n.addEventListener("onPhoto",a=>c(this,null,function*(){let o=a.detail;o===null?t(new k("User cancelled photos app")):o instanceof Error?t(o):i(yield this._getCameraPhoto(o,e)),n.dismiss(),document.body.removeChild(n)})),n.present()}catch{this.fileInputExperience(e,i,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,i,t)})}fileInputExperience(e,i,t){let n=document.querySelector("#_capacitor-camera-input"),a=()=>{var o;(o=n.parentNode)===null||o===void 0||o.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",o=>{let s=n.files[0],l="jpeg";if(s.type==="image/png"?l="png":s.type==="image/gif"&&(l="gif"),e.resultType==="dataUrl"||e.resultType==="base64"){let u=new FileReader;u.addEventListener("load",()=>{if(e.resultType==="dataUrl")i({dataUrl:u.result,format:l});else if(e.resultType==="base64"){let g=u.result.split(",")[1];i({base64String:g,format:l})}a()}),u.readAsDataURL(s)}else i({webPath:URL.createObjectURL(s),format:l}),a()}),n.addEventListener("cancel",o=>{t(new k("User cancelled photos app")),a()})),n.accept="image/*",n.capture=!0,e.source===S.Photos||e.source===S.Prompt?n.removeAttribute("capture"):e.direction===F.Front?n.capture="user":e.direction===F.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(e,i){let t=document.querySelector("#_capacitor-camera-input-multiple"),n=()=>{var a;(a=t.parentNode)===null||a===void 0||a.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",a=>{let o=[];for(let s=0;s<t.files.length;s++){let l=t.files[s],u="jpeg";l.type==="image/png"?u="png":l.type==="image/gif"&&(u="gif"),o.push({webPath:URL.createObjectURL(l),format:u})}e({photos:o}),n()}),t.addEventListener("cancel",a=>{i(new k("User cancelled photos app")),n()})),t.accept="image/*",t.click()}_getCameraPhoto(e,i){return new Promise((t,n)=>{let a=new FileReader,o=e.type.split("/")[1];i.resultType==="uri"?t({webPath:URL.createObjectURL(e),format:o,saved:!1}):(a.readAsDataURL(e),a.onloadend=()=>{let s=a.result;i.resultType==="dataUrl"?t({dataUrl:s,format:o,saved:!1}):t({base64String:s.split(",")[1],format:o,saved:!1})},a.onerror=s=>{n(s)})})}checkPermissions(){return c(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return c(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return c(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return c(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},tt=new T;var xe=D("Camera",{web:()=>new T});var Re=K("BackgroundRemoval",{web:()=>import("./chunk-W3527X35.js").then(r=>new r.BackgroundRemovalWeb)}),oe=Re;var Pe=(()=>{let e=class e{constructor(){this.bgRemovalAvailable=null,this.checkBackgroundRemovalAvailability()}checkBackgroundRemovalAvailability(){return c(this,null,function*(){try{let t=yield oe.isAvailable();this.bgRemovalAvailable=t.available,console.log(`Background removal available: ${t.available} (${t.platform})`)}catch{this.bgRemovalAvailable=!1,console.log("Background removal not available")}})}takePicture(){return c(this,null,function*(){return(yield xe.getPhoto({quality:100,allowEditing:!1,resultType:re.DataUrl,source:S.Camera})).dataUrl||""})}cropImage(t,n,a,o,s){return c(this,null,function*(){return new Promise((l,u)=>{let g=new Image;g.onload=()=>{let d=document.createElement("canvas"),m=d.getContext("2d");if(!m){u(new Error("Could not get canvas context"));return}d.width=o,d.height=s,m.drawImage(g,n,a,o,s,0,0,o,s),l(d.toDataURL("image/png"))},g.onerror=u,g.src=t})})}resizeImage(t,n=256,a=256){return c(this,null,function*(){return new Promise((o,s)=>{let l=new Image;l.onload=()=>{let u=document.createElement("canvas"),g=u.getContext("2d");if(!g){s(new Error("Could not get canvas context"));return}u.width=n,u.height=a,g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.drawImage(l,0,0,n,a),o(u.toDataURL("image/png"))},l.onerror=s,l.src=t})})}compressImage(t,n=10){return c(this,null,function*(){let a=yield this.loadImage(t),o=document.createElement("canvas"),s=o.getContext("2d");if(!s)throw new Error("Could not get canvas context");o.width=a.width,o.height=a.height,s.drawImage(a,0,0);let l=.1,u=.95,g=.7,d=null,m="",f=n*1024,b=1024;for(let _=0;_<8;_++){let h=yield this.canvasToBlob(o,g);if(Math.abs(h.size-f)<b){d=h;break}(!d||Math.abs(h.size-f)<Math.abs(d.size-f))&&(d=h),h.size>f?(u=g,g=(l+g)/2):(l=g,g=(u+g)/2)}if(!d)throw new Error("Failed to compress image");return m=yield this.blobToDataUrl(d),{dataUrl:m,blob:d,size:d.size}})}loadImage(t){return new Promise((n,a)=>{let o=new Image;o.onload=()=>n(o),o.onerror=a,o.src=t})}canvasToBlob(t,n){return new Promise((a,o)=>{t.toBlob(s=>{s?a(s):o(new Error("Failed to create blob"))},"image/jpeg",n)})}blobToDataUrl(t){return new Promise((n,a)=>{let o=new FileReader;o.onloadend=()=>n(o.result),o.onerror=a,o.readAsDataURL(t)})}removeBackground(t,n=!0){return c(this,null,function*(){try{let a=yield oe.removeBackground({imageData:t,useEllipticalMask:n});return{dataUrl:a.dataUrl,faceDetected:a.faceDetected}}catch(a){throw console.error("Background removal failed:",a),a}})}isBackgroundRemovalAvailable(){return c(this,null,function*(){return this.bgRemovalAvailable!==null?this.bgRemovalAvailable:(yield this.checkBackgroundRemovalAvailability(),this.bgRemovalAvailable??!1)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=le({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var Te=["videoElement"],je=["canvasElement"],Be=["detectionCanvas"];function ze(r,e){r&1&&(v(0,"div",15),de(),v(1,"svg",16),U(2,"ellipse",17),y()())}function He(r,e){if(r&1){let i=N();v(0,"div",5)(1,"div",6)(2,"div",7),U(3,"video",8,0)(5,"div",9),W(6,ze,3,0,"div",10),y(),v(7,"div",11),L(8),y(),U(9,"canvas",12,1)(11,"canvas",12,2),y(),v(13,"div",13)(14,"button",14),$("click",function(){z(i);let n=I();return H(n.captureAndProcess())}),y()()()}if(r&2){let i=I();x(3),Q("mirror",i.useFrontCamera),E("hidden",!i.isWebCameraActive),x(3),E("ngIf",!i.isWebCameraActive),x(),Q("success",i.faceGuidance==="hold_still")("warning",i.faceGuidance!=="hold_still"&&i.faceGuidance!=="no_face"&&i.faceGuidance!=="multiple_faces")("error",i.faceGuidance==="no_face"||i.faceGuidance==="multiple_faces"),x(),fe(" ",i.guidanceMessage," "),x(6),Q("disabled",i.faceGuidance!=="hold_still"),E("disabled",i.faceGuidance!=="hold_still")}}function We(r,e){if(r&1&&(v(0,"div",20),U(1,"div",21),v(2,"p",22),L(3),y()()),r&2){let i=I(2);x(3),ee(i.processingStep)}}function $e(r,e){if(r&1){let i=N();v(0,"div",20),U(1,"img",23),v(2,"div",24)(3,"span"),L(4),y(),v(5,"span",25),L(6,"\xB7"),y(),v(7,"span"),L(8,"256\xD7256"),y()(),v(9,"div",26)(10,"button",27),$("click",function(){z(i);let n=I(2);return H(n.retake())}),L(11,"Retake"),y(),v(12,"button",28),$("click",function(){z(i);let n=I(2);return H(n.downloadImage())}),L(13,"Download"),y()()()}if(r&2){let i=I(2);x(),E("src",i.processedImage.dataUrl,me),x(3),ee(i.formatFileSize(i.processedImage.size))}}function Ge(r,e){if(r&1&&(v(0,"div",18),W(1,We,4,1,"div",19)(2,$e,14,2,"div",19),y()),r&2){let i=I();x(),E("ngIf",i.isProcessing),x(),E("ngIf",i.processedImage&&!i.isProcessing)}}var vt=(()=>{let e=class e{constructor(t,n){this.imageProcessingService=t,this.ngZone=n,this.processedImage=null,this.isProcessing=!1,this.processingStep="",this.isCameraActive=!1,this.isWebCameraActive=!1,this.useFrontCamera=!0,this.mediaStream=null,this.faceGuidance="no_face",this.guidanceMessage="Initializing...",this.faceDetectionReady=!1,this.isDetecting=!1,this.detectionInterval=null,this.ovalBounds={centerX:.5,centerY:.5,radiusX:.32,radiusY:.42},this.initializeFaceDetection()}ngOnInit(){this.startCamera()}ngOnDestroy(){this.stopWebCamera(),this.stopFaceDetection(),X.dispose().catch(()=>{})}initializeFaceDetection(){return c(this,null,function*(){try{console.log("Initializing face detection...");let t=yield X.initialize();this.faceDetectionReady=t.success,console.log("Face detection ready:",t.success),t.success?this.guidanceMessage="Position your face in the frame":this.guidanceMessage="Face detection unavailable"}catch(t){console.error("Face detection init error:",t),this.faceDetectionReady=!1,this.guidanceMessage="Face detection unavailable"}})}startCamera(){return c(this,null,function*(){this.isCameraActive=!0,this.processedImage=null,this.faceGuidance="no_face",this.guidanceMessage=this.faceDetectionReady?"Position your face in the frame":"Initializing...",ve.isNativePlatform()||setTimeout(()=>this.startWebCamera(),100)})}startWebCamera(){return c(this,null,function*(){try{let t={video:{facingMode:this.useFrontCamera?"user":"environment",width:{ideal:1280},height:{ideal:720}},audio:!1};this.mediaStream=yield navigator.mediaDevices.getUserMedia(t),this.isWebCameraActive=!0;let n=(a=5)=>{if(this.videoElement?.nativeElement&&this.mediaStream){let o=this.videoElement.nativeElement;o.srcObject=this.mediaStream,o.onloadedmetadata=()=>{o.play().then(()=>{console.log("Camera stream started"),this.startFaceDetection()}).catch(s=>console.error("Error playing video:",s))}}else a>0&&setTimeout(()=>n(a-1),100)};setTimeout(()=>n(),100)}catch(t){console.error("Error accessing camera:",t),this.isWebCameraActive=!1,this.isCameraActive=!1}})}startFaceDetection(){if(this.detectionInterval)return;let t=(n=20)=>{this.faceDetectionReady?(console.log("Starting face detection loop"),this.detectionInterval=setInterval(()=>{this.isWebCameraActive&&!this.isDetecting&&this.detectFaceInFrame()},250)):n>0?setTimeout(()=>t(n-1),500):(console.log("Face detection not available, skipping"),this.guidanceMessage="Position your face in the frame")};t()}stopFaceDetection(){this.detectionInterval&&(clearInterval(this.detectionInterval),this.detectionInterval=null),this.isDetecting=!1}detectFaceInFrame(){return c(this,null,function*(){if(!this.videoElement?.nativeElement||!this.detectionCanvas?.nativeElement)return;let t=this.videoElement.nativeElement;if(!(t.videoWidth===0||t.videoHeight===0)){this.isDetecting=!0;try{let n=this.detectionCanvas.nativeElement,a=n.getContext("2d");if(!a)return;let o=t.videoWidth,s=t.videoHeight,l=Math.min(o,s),u=(o-l)/2,g=(s-l)/2,d=Math.floor(l*.4);n.width=d,n.height=d,this.useFrontCamera&&(a.translate(n.width,0),a.scale(-1,1)),a.drawImage(t,u,g,l,l,0,0,d,d);let m=n.toDataURL("image/jpeg",.5),f=yield X.detectFace({imageData:m,ovalBounds:this.ovalBounds});this.ngZone.run(()=>{this.faceGuidance=f.guidance,this.guidanceMessage=be(f.guidance)})}catch(n){console.error("Face detection error:",n)}finally{this.isDetecting=!1}}})}stopWebCamera(){this.stopFaceDetection(),this.mediaStream&&(this.mediaStream.getTracks().forEach(t=>t.stop()),this.mediaStream=null),this.isWebCameraActive=!1}captureAndProcess(){return c(this,null,function*(){try{let t,n,a;if(this.isWebCameraActive&&this.videoElement?.nativeElement&&this.canvasElement?.nativeElement){let m=this.videoElement.nativeElement,f=this.canvasElement.nativeElement;f.width=m.videoWidth,f.height=m.videoHeight,n=m.videoWidth,a=m.videoHeight;let b=f.getContext("2d");if(!b)return;this.useFrontCamera&&(b.translate(f.width,0),b.scale(-1,1)),b.drawImage(m,0,0),t=f.toDataURL("image/jpeg",.95),this.stopWebCamera()}else{t=yield this.imageProcessingService.takePicture();let m=new Image;yield new Promise(f=>{m.onload=()=>{n=m.naturalWidth,a=m.naturalHeight,f()},m.src=t})}this.isCameraActive=!1,this.isProcessing=!0;let o=Math.min(n,a),s=Math.floor(o*.85),l=Math.floor((n-s)/2),u=Math.floor((a-s)/2);this.processingStep="Cropping...";let g=yield this.imageProcessingService.cropImage(t,l,u,s,s);this.processingStep="Resizing...",g=yield this.imageProcessingService.resizeImage(g,256,256),this.processingStep="Compressing to ~10KB...";let d=yield this.imageProcessingService.compressImage(g,10);this.processedImage=d,this.processingStep=""}catch(t){console.error("Error:",t),this.processingStep="Error: "+(t instanceof Error?t.message:"Unknown error"),this.isCameraActive=!1}finally{this.isProcessing=!1}})}retake(){this.processedImage=null,this.startCamera()}downloadImage(){return c(this,null,function*(){if(this.processedImage)try{let t=document.createElement("a");t.href=this.processedImage.dataUrl,t.download=`photo-${Date.now()}.jpg`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(t){console.error("Error downloading:",t)}})}formatFileSize(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB"}};e.\u0275fac=function(n){return new(n||e)(J(Pe),J(ue))},e.\u0275cmp=ge({type:e,selectors:[["app-home"]],viewQuery:function(n,a){if(n&1&&(G(Te,5),G(je,5),G(Be,5)),n&2){let o;q(o=V())&&(a.videoElement=o.first),q(o=V())&&(a.canvasElement=o.first),q(o=V())&&(a.detectionCanvas=o.first)}},decls:2,vars:2,consts:[["videoElement",""],["canvasElement",""],["detectionCanvas",""],["class","camera-container",4,"ngIf"],["class","app-container",4,"ngIf"],[1,"camera-container"],[1,"camera-preview-area"],[1,"video-frame"],["autoplay","","playsinline","","muted","",1,"camera-video",3,"hidden"],[1,"oval-overlay"],["class","face-silhouette",4,"ngIf"],[1,"guidance-badge"],[2,"display","none"],[1,"camera-controls"],[1,"btn-capture",3,"click","disabled"],[1,"face-silhouette"],["viewBox","0 0 100 120","xmlns","http://www.w3.org/2000/svg"],["cx","50","cy","45","rx","30","ry","35"],[1,"app-container"],["class","content-card",4,"ngIf"],[1,"content-card"],[1,"spinner"],[1,"processing-text"],["alt","Result",1,"result-image",3,"src"],[1,"result-info"],[1,"dot"],[1,"result-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click"]],template:function(n,a){n&1&&W(0,He,15,14,"div",3)(1,Ge,3,2,"div",4),n&2&&(E("ngIf",a.isCameraActive),x(),E("ngIf",!a.isCameraActive))},dependencies:[he,pe],styles:["[_nghost-%COMP%]{display:block;background:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;font-size:14px;min-height:100vh;width:100%}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{background:#fff!important;margin:0;padding:0}.app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:16px;box-sizing:border-box;background:#fff;width:100%}.content-card[_ngcontent-%COMP%]{text-align:center;width:100%;max-width:320px}.content-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin:0 0 12px;color:#202124}.pipeline-steps[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px;padding:14px 16px;background:#f8f9fa;border-radius:8px;margin-bottom:16px;font-size:12px;font-weight:500;color:#5f6368}.pipeline-steps[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:#9aa0a6}.btn-primary[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:12px 20px;background:#1a73e8;color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background .2s}.btn-primary[_ngcontent-%COMP%]:hover{background:#1557b0}.btn-primary[_ngcontent-%COMP%]:active{transform:scale(.98)}.btn-primary[_ngcontent-%COMP%]   .btn-icon-inline[_ngcontent-%COMP%]{font-size:16px}.btn-secondary[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:10px 20px;background:#fff;color:#202124;border:1px solid #dadce0;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background .2s,border-color .2s}.btn-secondary[_ngcontent-%COMP%]:hover{background:#f8f9fa;border-color:#bdc1c6}.btn-secondary[_ngcontent-%COMP%]:active{transform:scale(.98)}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;margin:0 auto 12px;border:3px solid #f8f9fa;border-top-color:#1a73e8;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.processing-text[_ngcontent-%COMP%]{color:#5f6368;font-size:13px;margin:0}.result-image[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:8px;border:1px solid #dadce0;margin-bottom:12px;object-fit:cover;background:#f8f9fa}.result-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:6px;font-size:12px;color:#5f6368;margin-bottom:16px}.result-info[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{color:#dadce0}.result-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:center}.result-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;max-width:120px}.camera-container[_ngcontent-%COMP%]{position:fixed;inset:0;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000}.camera-preview-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px;min-height:0;background:#fff}.video-frame[_ngcontent-%COMP%]{position:relative;width:min(280px,80vw,50vh);height:min(280px,80vw,50vh);background:#e8eaed;border-radius:12px;overflow:hidden;flex-shrink:0;border:1px solid #dadce0}.camera-video[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}.camera-video.mirror[_ngcontent-%COMP%]{transform:scaleX(-1)}.camera-video[hidden][_ngcontent-%COMP%]{display:none!important}.oval-overlay[_ngcontent-%COMP%]{position:absolute;inset:8% 18%;border:3px solid #1a73e8;border-radius:50%;pointer-events:none;box-shadow:0 0 0 2000px #ffffff80}.face-silhouette[_ngcontent-%COMP%]{position:absolute;inset:20% 25% 15%;opacity:.2;pointer-events:none}.face-silhouette[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%;fill:#9aa0a6}.camera-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:32px;padding:16px 0;flex-shrink:0;background:#fff}.btn-capture[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:50%;background:#1a73e8;border:3px solid #fff;cursor:pointer;box-shadow:0 2px 8px #1a73e866;transition:transform .1s,background .2s,opacity .2s}.btn-capture[_ngcontent-%COMP%]:hover:not(.disabled){background:#1557b0;transform:scale(1.05)}.btn-capture[_ngcontent-%COMP%]:active:not(.disabled){transform:scale(.95)}.btn-capture.disabled[_ngcontent-%COMP%]{background:#dadce0;cursor:not-allowed;opacity:.5;box-shadow:none}.guidance-badge[_ngcontent-%COMP%]{margin-top:12px;padding:8px 20px;border-radius:16px;font-size:13px;font-weight:500;text-align:center;white-space:nowrap;transition:all .3s ease;background:#f1f3f4;color:#5f6368;border:1px solid #dadce0}.guidance-badge.success[_ngcontent-%COMP%]{background:#e6f4ea;color:#137333;border-color:#34a853}.guidance-badge.warning[_ngcontent-%COMP%]{background:#fef7e0;color:#b45309;border-color:#f9ab00}.guidance-badge.error[_ngcontent-%COMP%]{background:#fce8e6;color:#c5221f;border-color:#ea4335}ion-header[_ngcontent-%COMP%]{display:none!important}"]});let r=e;return r})();export{vt as HomePage};
